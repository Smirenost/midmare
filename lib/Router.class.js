"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Router=void 0;const Route_class_1=require("./Route.class"),Application_class_1=require("./Application.class");var Router;!function(t){class e{constructor(t){this.options=t,this.stack=[],this.params={}}use(t,s){s="function"==typeof t?t:s;const r="string"==typeof t;if((s=Array.isArray(s)?s:[s]).some(t=>"function"!=typeof t))throw new TypeError("Middleware should be function or array of functions.");return s.forEach(s=>{if(s.router){const o=Object.assign(Object.create(e.prototype),s.router,{stack:s.router.stack.slice(0)});for(let e=0;e<o.stack.length;e++){const s=o.stack[e],a=Object.assign(Object.create(Route_class_1.Route.Route.prototype),s);r&&a.setPrefix(t),this.options.prefix&&a.setPrefix(this.options.prefix),this.stack.push(a),o.stack[e]=a}if(this.params){(t=>{const e=t;for(let t=0;t<e.length;t++){const s=e[t];o.param(s,this.params[s])}})(Object.keys(this.params))}}else this.register(r?t:"(.*)",s,{end:!1,ignoreCaptures:!r})}),this}register(t,e,s={}){const r=this.stack,o=new Route_class_1.Route.Route(t,e,{end:!!s.end||s.end,name:s.name,sensitive:s.sensitive||this.options.sensitive||!1,strict:s.strict||this.options.strict||!1,prefix:s.prefix||this.options.prefix||"",ignoreCaptures:s.ignoreCaptures});this.options.prefix&&o.setPrefix(this.options.prefix);for(let t=0;t<Object.keys(this.params).length;t++){const e=Object.keys(this.params)[t];o.param(e,this.params[e])}return r.push(o),o}route(t){const e=this.stack;for(let s=e.length,r=0;r<s;r++)if(e[r].name&&e[r].name===t)return e[r];return!1}match(t){const e=this.stack;let s;const r={path:[],route:!1};for(let o=e.length,a=0;a<o;a++)s=e[a],s.match(t)&&(r.path.push(s),r.route=!0);return r}param(t,e){this.params[t]=e;for(let s=0;s<this.stack.length;s++){this.stack[s].param(t,e)}return this}routes(){const t=this;let e=(e,s)=>{const r=t.options.routerPath||e.routerPath||e.path,o=t.match(r);let a;if(e.matched?e.matched.push.apply(e.matched,o.path):e.matched=o.path,e.router=t,!o.route)return s();const i=o.path,n=i[i.length-1];return e._matchedRoute=n.path,n.name&&(e._matchedRouteName=n.name),a=i.reduce((t,e)=>(t.push((t,s)=>(t.captures=e.captures(r),t.params=e.params(t.captures,t.params),t.routerName=e.name,s())),t.concat(e.stack)),[]),Application_class_1.Application.Application.createCompose(a)(e,s).then(()=>e.__handleEnd()).catch(e.error)};return e.router=t,e}process(t,e,s){return"string"==typeof e||e instanceof RegExp?s=Array.prototype.slice.call(arguments,2):(s=Array.prototype.slice.call(arguments,1),e=t,t=null),this.register(e,s,{name:t}),this}}t.Router=e}(Router=exports.Router||(exports.Router={}));
//# sourceMappingURL=../maps/lib/Router.class.js.map
